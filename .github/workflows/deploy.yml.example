# Example: Deployment Workflow
# Rename this file to deploy.yml to enable manual deployment
# This is an example - modify according to your deployment platform

name: Deploy Application

# Manual deployment trigger
on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        type: choice
        options:
          - staging
          - production
      version:
        description: 'Version tag (optional)'
        required: false
        type: string

jobs:
  deploy:
    name: Deploy to ${{ github.event.inputs.environment }}
    runs-on: ubuntu-latest
    # Only allow deployment from main branch
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Build Docker image
        uses: docker/build-push-action@v5
        with:
          context: .
          push: true  # Push to registry
          tags: |
            your-registry/lis-app:${{ github.event.inputs.version || github.sha }}
            your-registry/lis-app:latest
          cache-from: type=registry,ref=your-registry/lis-app:buildcache
          cache-to: type=registry,ref=your-registry/lis-app:buildcache,mode=max
      
      # Example: Deploy to Render.com
      # - name: Deploy to Render
      #   uses: johnbeynon/render-deploy@v0.0.8
      #   with:
      #     service-id: ${{ secrets.RENDER_SERVICE_ID }}
      #     api-key: ${{ secrets.RENDER_API_KEY }}
      
      # Example: Deploy to Railway.app
      # - name: Deploy to Railway
      #   uses: bervProject/railway-deploy@v0.1.3
      #   with:
      #     railway_token: ${{ secrets.RAILWAY_TOKEN }}
      #     service: lis-app
      
      # Example: Deploy to Fly.io
      # - name: Setup Fly.io
      #   uses: superfly/flyctl-actions/setup-flyctl@master
      # - name: Deploy to Fly.io
      #   run: flyctl deploy --remote-only
      #   env:
      #     FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
      
      - name: Deployment Status
        run: |
          echo "âœ… Deployment completed to ${{ github.event.inputs.environment }}"
          echo "Version: ${{ github.event.inputs.version || github.sha }}"